/* jquery.documentcloud-inline - 0.0.1 2013-10-07 */
!function(a,b,c){function d(b){this.settings=a.extend({},h,b),this._defaults=h,this._name=f,this._version=g,this.init()}function e(b,c,d){this.el=b,this.$el=a(b),this.popupContainer=d,this.settings=a.extend({},h,c),this._defaults=h,this._name=f,this._version=g,this.init()}var f="documentCloudInline",g="0.0.1",h={documentAttribute:"document",noteAttribute:"note",attachTo:"body"};d.prototype={init:function(){a(this.settings.attachTo).append('<div class="dc-note-popup" id="dc-note-popup">&nbsp;</div>'),this.popupContainer=a("#dc-note-popup"),this.setCloseEvent()},getContainer:function(){return this.popupContainer},setCloseEvent:function(){var b=this.popupContainer;a(c).keyup(function(a){27===a.which&&b.hide()})}},e.prototype={containerTemplate:function(){return'<div id="DC-note-'+this.note_id+'" class="DC-note-container">'},dcUrlTemplate:function(){return"http://www.documentcloud.org/documents/"+this.doc_id+"/annotations/"+this.note_id+".js"},init:function(){this.doc_id=this.$el.data(this.settings.documentAttribute),this.note_id=this.$el.data(this.settings.noteAttribute),this.$el.on("click",a.proxy(this.load,this))},load:function(b){b.preventDefault(),this.popupContainer.html(this.containerTemplate()),dc.embed.loadNote(this.dcUrlTemplate(),{afterLoad:a.proxy(this.postLoad,this)})},postLoad:function(){this.popupContainer.show();var b=this.$el.offset().top-a(".DC-note-container").height()-30,c=this.$el.offset().top+5,d=this.$el.offset().left+this.$el.width()/2-this.popupContainer.width()/2;this.popupContainer.offset({top:b>0?b:c,left:d>0?d:10}),a(".DC-note").append('<div class="close-prompt">Close</div>'),a(".DC-note-contents a").attr("target","_blank"),a("body, .close-prompt").on("click",a.proxy(this.close,this)),this.scrollHandler()},close:function(){this.popupContainer.hide()},scrollHandler:function(){var b=a(c).scrollTop(),d=this.popupContainer.offset().top-10;b>d&&a("html, body").animate({scrollTop:d},150)}},a.fn[f]=function(b){var c=new d(b),g=c.getContainer();return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b,g))})}}(jQuery,window,document);